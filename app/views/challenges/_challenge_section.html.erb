<%# app/views/challenges/_challenge_section.html.erb %>
<div class="mb-auto p-4 max-w-[90vw] bg-gradient-to-r from-[#0A1428]/20 to-[#0A0C14]/20 pt-4 rounded-lg shadow-md border border-slate-900"
     data-controller="pagination">
  <h3 class="text-3xl font-semibold mb-6 text-center text-[#C8AA6E] border-b pb-4 mx-6 border-[#C8AA6E]/20">
    <%= title %>
  </h3>

  <%= turbo_frame_tag "#{section_id}_challenges" do %>
    <div class="grid grid-cols-1 gap-y-6 mx-auto">
      <% challenges.each do |progress| %>
        <%= link_to challenge_path(progress[:challenge]), class: "block" do %>
          <div class="bg-slate-800/30 rounded-lg p-6 border border-slate-700/30 hover:border-[#C8AA6E]/50 hover:scale-105 hover:bg-slate-700/30 transition-all duration-300 w-full">
            <h4 class="text-xl text-[#C8AA6E] font-medium mb-2"><%= progress[:challenge].name %></h4>
            <p class="text-sm text-slate-400 mb-4"><%= progress[:challenge].description %></p>

            <div class="mt-4">
              <div class="flex justify-between text-sm mb-2">
                <span class="text-slate-400">Progress</span>
                <span class="text-[#C8AA6E]">
                  <%= progress[:progress][:current] %>/<%= progress[:progress][:total] %>
                </span>
              </div>

              <div class="w-full bg-slate-700/30 rounded-full h-2">
                <div class="h-2 rounded-full bg-[#C8AA6E]" 
                     style="width: <%= progress[:progress][:percentage] %>%;"></div>
              </div>
            </div>

            <% if progress[:progress][:percentage] == 100 %>
              <div class="mt-4 text-center">
                <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-sm">
                  Completed!
                </span>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>

<% if total_pages > 1 %>
  <div class="flex justify-between items-center mt-6 px-2">
    <%= link_to_prev_page challenges, section_id, current_page, total_pages,
        class: "px-4 py-2 text-[#C8AA6E] border border-[#C8AA6E]/50 rounded hover:bg-[#C8AA6E]/10 #{'opacity-50 cursor-not-allowed' if current_page == 1}" %>
    
    <span class="text-slate-400">
      Page <%= current_page %> of <%= total_pages %>
    </span>
    
    <%= link_to_next_page challenges, section_id, current_page, total_pages,
        class: "px-4 py-2 text-[#C8AA6E] border border-[#C8AA6E]/50 rounded hover:bg-[#C8AA6E]/10 #{'opacity-50 cursor-not-allowed' if current_page == total_pages}" %>
  </div>
<% end %>
  <% end %>
</div>